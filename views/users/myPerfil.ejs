<%- include ../layouts/cabeza.ejs %> 
<link rel="stylesheet" href="/stylesheets/components.css">
<link rel="stylesheet" href="/stylesheets/form.css">
<link rel="stylesheet" href="/stylesheets/users/myProfile.css">
<%- include ../layouts/cabecera.ejs %> 

<%- include ../layouts/menu-lateral.ejs%> 

<%- include ../layouts/messages.ejs%>

<main class="page-content" id="page-content">

  <div class="page-content-container">

    <header> <h1>Mi perfil</h1> </header>

    <section class="card-my-perfil  col-md-10">
      <article class="card-my-perfil-container">
        <div class="card-items-container">
          <form method="post" action="/users/uploadPhoto?codigo=<%= user[0].codigo%>" enctype="multipart/form-data" class="perfil-photo-container" id="formPhoto">
            <span class="icon-perfil-photo">
              <input name="file" type="file" id="file">
              <button id="buttonFile" type="button" class="perfil-photo">
                <% if (user[0].foto != '') { %>
                  <div class="image-container">
                    <img src="/images/users/<%=user[0].foto%>" alt="Foto de perfil">
                  </div>
                <% } else { %>
                  <svg xmlns="http://www.w3.org/2000/svg" viewBox="-6 -6 60 60" height="108" width="108">
                    <g fill="#4171ae">
                    <path fill="#ffffff" d="M22,27c6.195,0,11-6.988,11-13v-2c0-6.065-4.935-11-11-11S11,5.935,11,12v2C11,20.012,15.805,27,22,27z"></path> 
                    <path data-color="color-2" d="M37,28c-4.971,0-9,4.029-9,9s4.029,9,9,9s9-4.029,9-9S41.971,28,37,28z M41,38h-3v3 c0,0.552-0.448,1-1,1s-1-0.448-1-1v-3h-3c-0.552,0-1-0.448-1-1s0.448-1,1-1h3v-3c0-0.552,0.448-1,1-1s1,0.448,1,1v3h3 c0.552,0,1,0.448,1,1S41.552,38,41,38z"></path> 
                    <path fill="#ffffff" d="M26,37c0-2.495,0.84-4.788,2.24-6.634C26.315,30.145,24.233,30,22,30c-6.554,0-11.926,1.188-15.278,2.185 C3.3,33.203,1,36.286,1,39.856V44c0,0.552,0.448,1,1,1h27.466C27.337,42.994,26,40.156,26,37z"></path>
                    </g>
                  </svg>
                <%}%>
              </button>
            </span>
          </form>
         <div class="card-item">
           <div class="header-section card-item">
             <div class="header-container">
               <header class="card-header">
                 <h2 class="card-header-text"><%= user[0].nombre%></h2>
               </header>
             </div>
           </div>
           <div class="badge-text-container card-item">
            <span class="badge-text"><%= user[0].tipo_usuario%></span>
           </div>
           <div>
            <span class="text-user-id card-item">ID:<%= user[0].codigo%></span>
           </div>
          </div>
        </div>
      </article>
    </section>

    <section class="card-my-perfil  col-md-10">
      <article class="card-my-perfil-container">
        <header class="card-header">
          <h2 class="card-header-text">Datos del usuario</h2>
        </header>
        <div class="card-data-user-container">
          <div class="card-item-content">
            <div class="card-item-title"> <span>Tipo de usuario</span> </div>
            <div class="card-item-text"> <span><%=user[0].tipo_usuario%></span></div>
          </div>
          <div class="card-item-content">
            <div class="card-item-title"> <span>Nombre</span> </div>
            <div class="card-item-text"> <span><%=user[0].nombre%></span></div>
          </div>
          <div class="card-item-content">
            <div class="card-item-title"> <span>Nombre de usuario</span> </div>
            <div class="card-item-text"> <span id="usernameText"><%=user[0].nombre_usuario%></span></div>
          </div>
          <div class="card-item-content">
            <div class="card-item-title"> <span>Teléfono</span> </div>
            <div class="card-item-text"> <span><%= user[0].telefono%></span></div>
          </div>
          <div class="card-item-content">
            <div class="card-item-title"> <span>Correo electrónico</span> </div>
            <div class="card-item-text"> <span><%=user[0].email%></span> </div>
          </div>
          <div class="card-item-content">
            <div class="card-item-title"> <span>Estado</span> </div>
            <div class="card-item-text"> <span><%=user[0].estado%></span> </div>
          </div>
        </div>
        <div class="button-edit-profile">
          <a href="/users/editProfile" class="button  button-open-dialog">
            <span class="button-icon">
              <svg xmlns="http://www.w3.org/2000/svg" height="24" width="24" fill="currentColor"><path d="m19.3 8.925-4.25-4.2 1.4-1.4q.575-.575 1.413-.575.837 0 1.412.575l1.4 1.4q.575.575.6 1.388.025.812-.55 1.387ZM17.85 10.4 7.25 21H3v-4.25l10.6-10.6Z"/></svg>
            </span>
            <span class="button-text">Editar</span>
          </a>
        </div>
      </article>
    </section>

    <section class="card-my-perfil  col-md-10">
      <article class="card-my-perfil-container">
        <header class="card-header">
          <h2 class="card-header-text">Seguridad de la cuenta</h2>
        </header>
        <div class="button-edit-profile">
          <form method="get" action="/users/changePassword">
            <button type="submit" name="codigo" value="<%=user[0].codigo%>" class="button">
              <span class="button-icon">
                <svg xmlns="http://www.w3.org/2000/svg" height="24" width="24" fill="currentColor"><path d="m19.3 8.925-4.25-4.2 1.4-1.4q.575-.575 1.413-.575.837 0 1.412.575l1.4 1.4q.575.575.6 1.388.025.812-.55 1.387ZM17.85 10.4 7.25 21H3v-4.25l10.6-10.6Z"/></svg>
              </span>
              <span class="button-text">Cambiar contraseña</span>
            </button>
          </form>
        </div>
      </article>
    </section>
  </div>
</main>

<div class="ui-dialog-container" id="ui-dialog">
  <div class="ui-dialog">
    <header class="ui-dialog-header">
      <span class="ui-dialog-title" id="ui-dialog-title">Editar usuario</span>
      <button class="ui-dialog-button" id="ui-dialog-button-close">
        <span class="ui-dialog-button-icon">
          <svg xmlns="http://www.w3.org/2000/svg" height="24" width="24" fill="currentColor"><path d="M6.4 19 5 17.6l5.6-5.6L5 6.4 6.4 5l5.6 5.6L17.6 5 19 6.4 13.4 12l5.6 5.6-1.4 1.4-5.6-5.6Z"/></svg>
        </span>
        <span class="ui-dialog-button-text"></span>
      </button>
    </header>

    <div class="ui-dialog-content">
      <form method="post" action="/users/editUser?codigo=<%=user[0].codigo%>" class="form" id="formulario">
        <div class="field">
          <label class="field-label" for="typeOfUser">Tipo de usuario:</label>
          <select class="field-input" name="typeOfUser" id="">
            <% for( let tipoUsuario = 0; tipoUsuario < tiposUsuarios.length; tipoUsuario++ ) { %>
              <option value="<%=tiposUsuarios[tipoUsuario].codigo%>"><%=tiposUsuarios[tipoUsuario].tipo_usuario%></option>
            <% } %>
          </select>
        </div>
        <div class="field" id="group-name">
          <label class="field-label" for="name">Nombre:</label>
          <input class="field-input" value="<%=user[0].nombre%>" type="text" name="name" required>
          <span class="icon" id="icon">
          </span>
          <p class="input-message">El nombre tiene que ser de 4 a 16 dígitos y no puede contener números.</p>
        </div>
        <div class="field" id="group-username">
          <label class="field-label" for="username">Nombre de usuario:</label>
          <input class="field-input" id="userName" value="<%=user[0].nombre_usuario%>" type="text" name="userName" required>
          <span class="icon" id="icon">
          </span>
          <p class="input-message">El usuario tiene que ser de 4 a 16 dígitos y solo puede contener números, letras y guion bajo.</p>
        </div>
        <div class="field" id="group-telefono">
          <label class="field-label" for="phone">Teléfono:</label>
          <input class="field-input" value="<%=user[0].telefono%>" type="text" name="telefono" required>
          <span class="icon" id="icon">
          </span>
          <p class="input-message">El teléfono solo puede contener números y con un mínimo de 10 dígitos y un máximo de 14 dígitos.</p>
        </div>
        <div class="field" id="group-email">
          <label class="field-label" for="email">Correo electrónico:</label>
          <input class="field-input" value="<%=user[0].email%>" type="email" name="email" required>
          <span class="icon" id="icon">
          </span>
          <p class="input-message">El correo solo puede contener letras, números, puntos, guiones y guion bajo.</p>
        </div>
        <div class="field">
          <label class="field-label" for="status">Estado:</label>
          <select class="field-input" name="status" id="">
            <% if (user[0].estado === 'Activo') { %>
              <option value="true" selected>Activo</option>
              <option value="false">Inactivo</option>
            <% } else { %>
              <option value="true">Activo</option>
              <option value="false " selected>Inactivo</option>  
            <%}%>
          </select>
        </div>
        <div class="ui-dialog-buttons-container">
          <button class="ui-dialog-button-form" id="button-cancel" type="button">Cancelar</button>
          <button class="ui-dialog-button-form ui-dialog-button-primary" type="submit">Guardar</button>
        </div>
      </form>
    </div>
  </div>
</div>

<script src="/javascripts/ui-dialog.js"></script>
<script src="/javascripts/editUservalidation.js"></script>
<script src="/javascripts/message.js"></script>
<script src="/javascripts/uploadFile.js"></script>
<%- include ../layouts/pie.ejs%> 
